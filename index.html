<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Web CLI Reader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit-cover">
  <style>
    :root {
      --bg: #1e1e1e;
      --cli-bg: #111;
      --text: #e0e0e0;
      --accent: #4caf50;
      --error: #f44336;
      --info: #2196f3;
    }
    body {
      margin: 0;
      font-family: monospace;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      padding: 10px;
      background: var(--cli-bg);
      text-align: center;
      font-weight: bold;
      color: var(--accent);
    }
    #cli {
      flex: 1;
      background: var(--cli-bg);
      padding: 15px;
      overflow-y: auto;
      white-space: pre-wrap;
      font-size: 14px;
      line-height: 1.4;
    }
    #cli .command { color: var(--accent); }
    #cli .error { color: var(--error); }
    #cli .info { color: var(--info); }
    footer {
      display: flex;
      flex-direction: column;
      padding: 10px;
      background: var(--cli-bg);
    }
    #suggestion {
      margin-bottom: 5px;
      font-size: 12px;
      color: var(--info);
      min-height: 16px;
    }
    #command {
      flex: 1;
      padding: 10px;
      border: none;
      outline: none;
      background: #222;
      color: var(--text);
      font-family: monospace;
      font-size: 14px;
      border-radius: 4px;
    }
    @media (max-width: 600px) {
      #cli { font-size: 12px; }
      #command { font-size: 12px; }
    }
  </style>
</head>
<body>
  <header>Web CLI Reader</header>
  <div id="cli">Memuat dokumen dari main.txt...</div>
  <footer>
    <div id="suggestion"></div>
    <input type="text" id="command" placeholder="Ketik perintah lalu Enter...">
  </footer>

  <script>
    const cli = document.getElementById("cli");
    const commandInput = document.getElementById("command");
    const suggestionBox = document.getElementById("suggestion");
    let docs = [];

    const commands = ["show", "list", "search", "help"];

    function print(msg, cls="") {
      const span = document.createElement("div");
      if (cls) span.classList.add(cls);
      span.textContent = msg;
      cli.appendChild(span);
      cli.scrollTop = cli.scrollHeight;
    }

    // Baca main.txt
    fetch("main.txt")
      .then(res => res.text())
      .then(text => {
        docs = text.split("\n")
          .map(line => line.trim())
          .filter(Boolean)
          .map((line, idx) => {
            const [judul, tanggal, kategori, lokasi] = line.split("|");
            return { judul, tanggal, kategori, lokasi, originalIndex: idx + 1 };
          });
        print("Sistem siap. Ketik 'help' untuk melihat daftar perintah.", "info");
      })
      .catch(err => {
        print("Gagal membaca main.txt: " + err, "error");
      });

    function showList(keyword, range) {
      let list = [...docs];
      if (keyword === "az") list.sort((a,b)=>a.judul.localeCompare(b.judul));
      else if (keyword === "za") list.sort((a,b)=>b.judul.localeCompare(a.judul));
      else if (keyword === "baru") list.sort((a,b)=>new Date(b.tanggal)-new Date(a.tanggal));
      else if (keyword === "lama") list.sort((a,b)=>new Date(a.tanggal)-new Date(b.tanggal));

      if (range) {
        const [startStr,endStr]=range.split("-");
        const start=parseInt(startStr,10)-1;
        const end=parseInt(endStr,10);
        if(!isNaN(start)&&!isNaN(end)&&start>=0&&end>start){
          list=list.slice(start,end);
        }
      }
      print("Daftar dokumen:", "info");
      list.forEach(d=>print(`${d.originalIndex}. ${d.judul} (${d.tanggal})`));
    }

    function searchDocs(keyword) {
      const results = docs.filter(d =>
        d.judul.toLowerCase().includes(keyword.toLowerCase()) ||
        d.tanggal.toLowerCase().includes(keyword.toLowerCase()) ||
        d.kategori.toLowerCase().includes(keyword.toLowerCase())
      );
      if(results.length===0) print(`Tidak ada dokumen cocok dengan "${keyword}".`, "error");
      else {
        print(`Hasil pencarian "${keyword}":`, "info");
        results.forEach(d=>print(`${d.originalIndex}. ${d.judul} (${d.tanggal}) [${d.kategori}]`));
      }
    }

    function showHelp() {
      print(`=== Bantuan Perintah ===
- show <nomor> : tampilkan isi dokumen
- list [az|za|baru|lama] [start-end] : tampilkan daftar dokumen dengan filter + paging
  contoh: list baru 5-15
- search <keyword> : cari dokumen berdasarkan judul/tanggal/kategori
- help : tampilkan bantuan`, "info");
    }

    // Auto-suggestion
    commandInput.addEventListener("input", () => {
      const val = commandInput.value.trim().toLowerCase();
      if (!val) {
        suggestionBox.textContent = "";
        return;
      }
      const match = commands.find(c => c.startsWith(val));
      suggestionBox.textContent = match ? `Saran: ${match}` : "";
    });

    // Event listener CLI
    commandInput.addEventListener("keydown", e=>{
      if(e.key==="Enter"){
        const parts=commandInput.value.trim().split(" ");
        const cmd=parts[0];
        const arg=parts.slice(1).join(" ");
        print("> "+commandInput.value, "command");

        if(cmd==="show"){
          const idx=parseInt(arg,10)-1;
          if(isNaN(idx)||idx<0||idx>=docs.length) {
            print("Nomor tidak valid.","error");
          } else {
            fetch(docs[idx].lokasi)
              .then(res=>res.text())
              .then(content=>{
                // Buat container dokumen
                const container = document.createElement("div");

                // Judul (referensi langsung untuk scroll)
                const titleElem = document.createElement("div");
                titleElem.textContent = `=== ${docs[idx].judul} (${docs[idx].tanggal}) ===`;
                titleElem.classList.add("info");

                // Isi
                const contentElem = document.createElement("div");
                contentElem.textContent = content;

                // Susun dan append
                container.appendChild(titleElem);
                container.appendChild(contentElem);
                cli.appendChild(container);

                // Scroll ke judul terbaru (pakai referensi langsung, bukan getElementById)
                titleElem.scrollIntoView({ behavior: "smooth", block: "start" });
              })
              .catch(err=>print("Gagal membaca file: "+err,"error"));
          }
        } else if(cmd==="list"){
          const args=arg.split(" ").filter(Boolean);
          let keyword=args[0]||"";
          let range=args[1]||null;
          showList(keyword,range);
        } else if(cmd==="search"){
          if(!arg) print("Masukkan keyword pencarian.","error");
          else searchDocs(arg);
        } else if(cmd==="help"){
          showHelp();
        } else {
          print("Perintah tidak dikenal.","error");
        }

        commandInput.value="";
        suggestionBox.textContent="";
      }
    });
  </script>
</body>
</html>
